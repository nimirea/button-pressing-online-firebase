<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Tongue-Twister Experiment</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
	[v-cloak] {display:none}
  </style>

  <link href="https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@700&display=swap" rel="stylesheet">
  <link href="./style.css" rel="stylesheet" type="text/css" />
</head>
<body>

<div id="app" v-cloak>
  <p class="recording-bar" v-if="isRecording">recording</p>

  <!-- consent form -->
  <div v-if="!consentGiven">
    <h1>Consent Form Test</h1>
    <p>Text of consent form will go here. This is just a placeholder.</p>
    <p>
    Lorem ipsum dolor sit amet, consectetur adipiscing elit. In in tellus sem. Vivamus elementum porta ligula non tincidunt. Praesent pharetra sit amet orci in bibendum. Suspendisse pharetra eros at risus porttitor, id egestas neque tincidunt. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia curae; Cras fermentum diam eget ante suscipit, vel dictum dolor bibendum. Duis id egestas erat. Integer vehicula venenatis ipsum, eu condimentum metus viverra sed. Sed consequat dui ut sollicitudin ullamcorper. Vestibulum non velit tempus enim mattis suscipit. Maecenas velit elit, commodo a malesuada vitae, suscipit consequat massa.
    </p>
    <p>
    Orci varius natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Ut ac nisl accumsan lorem vulputate feugiat. Integer ante urna, blandit ut tortor at, porttitor vulputate massa. Donec eu elit metus. Donec vitae orci mollis, dapibus urna vel, eleifend nibh. Vivamus a nulla eu tellus egestas efficitur a vestibulum felis. Fusce fermentum tortor eget ex dapibus dignissim. Vestibulum elit ante, feugiat et bibendum non, sollicitudin ac turpis. Duis tristique tempus ex eu imperdiet. Duis vel neque risus. Nulla ultrices dictum nunc, et cursus nisl eleifend congue. Ut pharetra est velit, eget ultrices erat varius a. Nullam luctus vehicula ipsum, eu auctor lacus molestie eget.
    </p>
    <p>
    Maecenas auctor, velit sit amet dignissim blandit, lacus mi ultricies metus, sed condimentum sem enim in massa. Maecenas ut metus eget odio auctor venenatis sed nec magna. Donec id lacus eu urna condimentum auctor non ut massa. Quisque nisl urna, molestie sit amet tincidunt ut, imperdiet eu neque. Nunc sed dignissim metus, sit amet porta eros. Quisque elementum nibh in lacus pellentesque imperdiet. Morbi nec leo vitae orci lacinia pharetra volutpat sit amet risus. Proin libero justo, mollis sed ultrices at, mollis sed nunc. Etiam vehicula, nisi eu blandit maximus, dolor augue pharetra ipsum, viverra auctor metus libero sit amet dolor.
    </p>
    <p>
    Morbi sollicitudin, ipsum ut tincidunt interdum, leo odio elementum felis, dignissim tempor ligula felis vel arcu. Nullam maximus metus elit, vel feugiat diam efficitur vel. Morbi scelerisque eget elit id viverra. Pellentesque euismod rhoncus justo vitae aliquam. Vivamus sagittis dolor sit amet erat aliquet, vitae efficitur justo viverra. Sed at lectus augue. Sed egestas suscipit tellus at ultrices. Phasellus tincidunt mi velit, et condimentum velit condimentum eget. Donec aliquet nulla quis leo aliquam finibus. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. Vestibulum facilisis pretium dolor, vel tincidunt ipsum congue a.
    </p>
    <p>
    Donec blandit libero eu libero tristique tempor. Quisque eu leo volutpat, bibendum lorem eu, molestie ligula. Donec non diam ante. Integer vel nisl et augue eleifend blandit in sit amet nisi. Interdum et malesuada fames ac ante ipsum primis in faucibus. Morbi maximus purus at sapien commodo dictum. Etiam in ex tincidunt, viverra mauris quis, eleifend tortor. Aenean a posuere dolor.
    </p>
    <div class = "buttonbox">
      <button v-on:click="storeConsent" class="green">I agree! Take me to the experiment</button>
      <button v-on:click="rejected = true;" class="red">I do not consent</button>
    </div>
    <p v-if="rejected">Thanks for checking out our experiment. You may close this window now.</p>
  </div>

  <!-- mic check -->
  <div v-if="consentGiven & !expOver & taskList[currentTask].name == 'mic_check'">
    <h1>Task {{currentTask + 1}} of {{taskList.length}}: Microphone Test</h1>
    <p>We will need to record your voice during this experiment, so
      at this time, we'd like you to check that your microphone is properly placed.
    </p>
    <p>
      When you are ready, please press the button, and then start speaking at a
      comfortable volume.
      Adjust your microphone so that the bar at the bottom of the screen
      is in the "just right" <span class="light-green">(green)</span> range whenever you are speaking.
      This test will not be stored.
    </p>
    <p>
      (Note: whenever your microphone is active during this experiment, you will
      see a <span class="red">red</span> "recording" bar at the top of your
      screen.)
    </p>
    <button v-on:click="startTask" v-if="!isRecording"><span class="rec-symbols">&#x25cf;</span> start test</button>
    <button v-on:click="stopTask" v-if="isRecording"><span class="rec-symbols">&#9632;</span> stop test and continue</button>

    <!--volume feedback-->
    <p style="text-align:center;">&nbsp;<span v-if="isRecording">{{ soundbar.message }}</span></p>
    <!-- volume meter  -->
    <div
      style="width:100%;height:0.75rem;border:1px solid black; z-index:1"
      v-bind:style="{'background':'linear-gradient(90deg, rgba(0,0,0,1)' +  soundbar.width + '%, rgba(255,255,255,0) ' +  soundbar.width + '%)'}">
      <!-- range marker -->
      <div
        v-bind:style="{'width': soundbar.cutoffs.high - soundbar.cutoffs.low + '%', marginLeft: soundbar.cutoffs.low + '%'}"
        style="background-color: rgb(100, 250, 100); height:2rem; position:relative; top: -0.625rem; z-index: -1"></div>
    </div>
  </div>

  <!-- main experiment flow (tongue-twisters) -->
  <div v-if="consentGiven && !expOver && taskList[currentTask].name == 'TT'">
    <div v-if="!isStarted">
      <h1>Task {{currentTask + 1}} of {{taskList.length}}</h1>
      <p>
        We will now ask you to read some tongue-twisters to the beat of a
        metronome. You will see a single tongue-twister appear on the screen,
        and, after one second, you will hear the metronome begin at a slow pace.
        After four beats (1 repetition of the tongue-twister), the metronome
        will speed up for the next 3 repetitions. Click the button below to hear
        an example trial for the tongue-twister "ghib ting pin sid":
      </p>
      <button v-on:click="sampleTrial">&#9658; play example</button>
      <p>
        Please do your best to keep up with the metronome! If you make a
        mistake, DO <b>NOT</b> go back to correct yourself.
      </p>
      <p>
        Please perform this task <b>with your headphones on, in a quiet
        place</b>. You can replay the example trial above and adjust your
        volume to make sure you can comfortably hear the metronome.
      </p>
      <p>
        This task should last approximately {{ stimList.length * .25 }}
        minutes. Your recordings will be stored and uploaded for analysis.
      </p>
      <button v-on:click="startTask">start experiment (recording will begin automatically)</button>
    </div>

    <div v-if="isStarted" class="stim">
      <p v-if="!trialEnded">{{ stimList[currentStim]['twister'] }}</p>
      <button v-on:click="nextTrial" v-if="trialEnded">next</button>
    </div>
  </div>

  <!-- experiment over -->
  <div v-if="!expOver && taskList[currentTask].name == 'survey'">
    <h1>Task {{currentTask + 1}} of {{taskList.length}}: Post-Experiment Questionnaire</h1>

    <h2>What browser are you using?</h2>

    <input type="radio" v-model="surveyData.browser" value="chrome" id="chrome-browser">
    <label for="chrome-browser">Chrome</label></br>

    <input type="radio" v-model="surveyData.browser" value="firefox" id="firefox-browser">
    <label for="firefox-browser">Firefox</label></br>

    <input type="radio" v-model="surveyData.browser" value="ie" id="ie-browser">
    <label for="ie-browser">Internet Explorer</label><br/>

    <input type="radio" v-model="surveyData.browser" value="safari" id="safari-browser">
    <label for="safari-browser">Safari</label><br/>

    <input type="radio" v-model="surveyData.browser" value="other" id="other-browser">
    <label for="other-browser">Other
      <input v-if="surveyData.browser == 'other'" v-model="surveyData.browserOther" placeholder="please specify">
    </label>

    <h2>What operating system are you using?</h2>

    <input type="radio" v-model="surveyData.os" value="windows" id="windows-os">
    <label for="windows-os">Windows</label></br>

    <input type="radio" v-model="surveyData.os" value="mac" id="mac-os">
    <label for="mac-os">Mac</label></br>

    <input type="radio" v-model="surveyData.os" value="linux" id="linux-os">
    <label for="linux-os">Linux</label></br>

    <input type="radio" v-model="surveyData.os" value="other" id="other-os">
    <label for="other-os">Other
      <input v-if="surveyData.os == 'other'" v-model="surveyData.osOther" placeholder="please specify">
    </label>



    <h2>Did you use headphones to complete this experiment?</h2>
    <input type="radio" v-model="surveyData.headphones" value="yes" id="yes-headphones">
    <label for="yes-headphones">Yes</label><br/>

    <input type="radio" v-model="surveyData.headphones" value="no" id="no-headphones">
    <label for="no-headphones">No</label>

    <div v-if="surveyData.headphones === 'yes'">
      <h2>When recording your voice, which microphone did you use?</h2>

      <input type="radio" v-model="surveyData.mic_type" value="headphones" id="headphones-mic">
      <label for="headphones-mic">Headphone microphone</label><br/>

      <input type="radio" v-model="surveyData.mic_type" value="built-in" id="builtin-mic">
      <label for="builtin-mic">Computer's built-in microphone</label>
    </div>

    <div v-if="surveyData.mic_type === 'headphones'">
      <h2>Are your headphones wired or wireless/Bluetooth?</h2>

      <input type="radio" v-model="surveyData.mic_wired" value="wired" id="wired-mic">
      <label for="wired-mic">Wired</label><br/>

      <input type="radio" v-model="surveyData.mic_wired" value="bt" id="bt-mic">
      <label for="bt-mic">Wireless/Bluetooth</label>
    </div>

    <h2>Is there anything else you'd like us to know about your experience? (optional)</h2>
    <textarea v-model="surveyData.anything_else"></textarea>

    <button v-on:click="submitSurvey" v-if="surveyData.browser != null && surveyData.os != null && (surveyData.headphones == 'no' || surveyData.mic_type == 'built-in' || surveyData.mic_wired !== null)">
      submit answers
    </button>

  </div>

  <p v-if="expOver">Your response has been successfully submitted. Thank you for taking part in our experiment!</p>
</div>

<!-- other external libraries used -->
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pizzicato/0.6.1/Pizzicato.min.js"></script>

<!-- same-source scripts -->
<script type="text/javascript" src="./papaparse.min.js"></script>
<script type="text/javascript" src="./recorder.js"></script>
<script type="text/javascript" src="./FileSaver.js"></script>

<!-- firebase -->
<script src="https://www.gstatic.com/firebasejs/7.14.3/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.14.2/firebase-storage.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.14.2/firebase-database.js"></script>


<script src="/__/firebase/init.js"></script>

<script type="text/javascript" src="main.js"></script>

</body>
</html>
